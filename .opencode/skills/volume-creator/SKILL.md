---

name: volume-creator
description: 批量创建虚拟磁盘，支持可定制参数和智能命名策略
license: MIT
compatibility: opencode
metadata:
  audience: storage-admins
  workflow: volume-management
  version: "1.0"
  author: "OpenCode Assistant"
---

## 🌐 环境管理

**⚠️ 重要提醒：** 在执行磁盘创建前，需要指定目标环境。如果未指定环境，我将列出所有可用环境供您选择。

### 环境配置要求
- **环境信息**：存储在 `environments.json` 文件中
- **包含内容**：IP地址、用户名、密码、环境描述
- **管理工具**：使用 `env_manager.py` 进行环境管理

### 环境选择流程
1. **未指定环境** → 列出所有可用环境
2. **环境确认** → 选择目标环境ID
3. **验证连接** → 测试环境可达性
4. **执行创建** → 在指定环境中创建磁盘

### 快速环境管理命令
```bash
# 列出所有环境
python env_manager.py list

# 显示环境详情
python env_manager.py show production

# 添加新环境
python env_manager.py add new_env

# 搜索环境
python env_manager.py search 生产
```

## 我的功能
🎯 **批量磁盘创建** - 一次性创建多个虚拟磁盘，支持1-100个磁盘的批量操作

⚙️ **参数自定义** - 完全控制磁盘配置：
- 存储管理ID选择
- 页面大小配置（4KB/8KB/16KB/32KB）
- 数据压缩方式（禁用/LZ4/Gzip_opt/Gzip_high）
- 磁盘大小（GB）
- 性能参数（IOPS：75-250000，带宽：1-1000 MB/s）
- 读缓存开关
- 区域选择

🏷️ **智能命名策略** - 支持多种命名模式：
- 顺序命名：`prefix-0`、`prefix-1`、`prefix-2`...
- 时间戳命名：`disk-20250130-001`、`disk-20250130-002`...
- UUID命名：`volume-{uuid}`

✅ **完整性保证** - 多层验证机制：
- API参数范围检查
- 存储资源可用性验证
- 命名冲突检测
- 配额限制检查

📊 **实时反馈** - 详细的进度跟踪和结果汇总

## 何时使用我

🎯 **批量部署场景**：
- 为VM集群批量准备存储
- 测试环境的快速磁盘部署
- 开发环境的标准化磁盘配置

🔧 **运维管理场景**：
- 扩展现有存储资源
- 标准化磁盘配置
- 与自动化运维脚本集成

## 使用流程

### 1. 需求分析阶段
我会询问您以下关键信息：
```
✦ 需要创建多少个磁盘？（1-100）
✦ 每个磁盘的大小？（GB）
✦ 主要用途？（数据库/文件存储/测试/开发）
✦ 性能要求？（高性能/标准/经济型）
✦ 命名偏好？（自动生成/指定前缀）
```

### 2. 参数配置阶段
根据您的需求，我将：
- 推荐最优参数组合
- 显示所有可配置选项
- 实时验证参数合法性

### 3. 确认阶段
我将提供：
- 完整配置汇总
- 预计创建时间
- 资源消耗估算
- 操作确认提示

### 4. 执行监控阶段
创建过程中提供：
- 实时进度（创建中：3/10）
- 成功/失败统计
- 详细错误信息（如有）
- 完成时间汇总

## 参数配置参考

### 📋 核心参数表

| 参数 | 选项/范围 | 推荐场景 | 默认值 |
|-----------|---------------|---------------------|---------|
| **页面大小** | 4KB, 8KB, 16KB, 32KB | 数据库=8KB, 文件=16KB | 4KB |
| **压缩方式** | 禁用, LZ4, Gzip_opt, Gzip_high | 测试=禁用, 生产=LZ4 | 禁用 |
| **IOPS范围** | 75-250000 | 数据库=10000+, 文件=1000+ | 100 |
| **带宽范围** | 1-1000 MB/s | 高性能=500+, 标准=100 | 100 |
| **读缓存** | 是, 否 | 读密集=是, 读写平衡=否 | 是 |

### 🎯 场景模板

**数据库磁盘模板：**
```yaml
pageSize: "8KB"
compression: "LZ4" 
iops: 5000
bandwidth: 200
readCache: true
```

**文件存储模板：**
```yaml
pageSize: "16KB"
compression: "Gzip_opt"
iops: 1000
bandwidth: 150
readCache: true
```

**测试环境模板：**
```yaml
pageSize: "4KB"
compression: "Disabled"
iops: 100
bandwidth: 50
readCache: false
```

## 实际使用示例

### 示例1：为数据库集群创建存储
```
用户：我需要为MySQL集群创建10个数据磁盘，每个50GB

智能推荐：
- 页面大小：8KB（数据库优化）
- 压缩方式：LZ4（平衡性能和压缩）
- IOPS：5000（数据库推荐）
- 带宽：200 MB/s
- 命名：mysql-data-0 到 mysql-data-9

确认配置并执行创建...
```

### 示例2：快速测试环境部署
```
用户：创建5个小测试磁盘，每个10GB

智能推荐：
- 使用测试模板（禁用压缩，低IOPS）
- 页面大小：4KB
- IOPS：100
- 命名：test-disk-001 到 test-disk-005

确认配置并执行批量创建...
```

### 示例3：自定义高性能配置
```
用户：需要为NoSQL数据库创建3个高性能磁盘

参数配置：
- 大小：每个200GB
- IOPS：15000（高性能）
- 带宽：500 MB/s
- 压缩：禁用（最大化性能）
- 命名前缀：nosql-highperf

确认并执行批量创建...
```

## 错误处理策略

### 🛡️ 常见问题处理

**参数限制错误：**
- 自动调整到最近的有效值
- 提供调整建议和原因
- 继续前请求用户确认

**存储资源不足：**
- 检查可用存储空间
- 建议减少磁盘大小或数量
- 提供替代存储选项

**命名冲突：**
- 自动添加时间戳后缀
- 提供多种替代命名方案
- 支持用户自定义命名

**部分创建失败：**
- 继续创建其他磁盘
- 详细记录失败原因
- 提供重试建议
- 生成部分成功报告

## 集成说明

### 🔗 与现有系统集成

**重用核心组件：**
- `ArcherAudit` - 认证和会话管理
- `Hosts` - 存储资源获取
- `Volumes.createDisk_vstor` - 核心创建逻辑

**遵循项目标准：**
- 中文文档字符串
- 详细错误日志
- 优雅异常处理
- 线程安全设计

### 📋 技术实现要点

**API调用优化：**
- 智能延迟控制（1秒间隔，避免API频率限制）
- 批量操作状态跟踪
- 实时响应解析

**数据结构设计：**
```python
# 磁盘创建结果
{
    "total": 10,
    "success": 8,
    "failed": 2,
    "disks": [...],  # 成功创建的磁盘信息
    "errors": [...]  # 详细失败原因
}
```

---

**开始使用：直接告诉我您的磁盘创建需求，我将智能配置并为您执行批量创建！**